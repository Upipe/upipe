/*
 * PCIeSDI library
 *
 * Copyright (C) 2018 / EnjoyDigital  / florent@enjoy-digital.fr
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>
 */

#ifndef GENLOCK_H
#define GENLOCK_H

/* genlock margins (in ns) */

#define GENLOCK_HSYNC_MARGIN 1000
#define GENLOCK_VSYNC_MARGIN 60000

/* genlock hsync/vsync periods (in ns) */

/* SMPTE259M */
#define SMPTE259M_PAL_HSYNC_PERIOD 64000
#define SMPTE259M_PAL_VSYNC_PERIOD 40000000

#define SMPTE259M_NTSC_HSYNC_PERIOD 63555
#define SMPTE259M_NTSC_VSYNC_PERIOD 33366700

/* SMPTE296M */
#define SMPTE296M_720P60_HSYNC_PERIOD 22222
#define SMPTE296M_720P60_VSYNC_PERIOD 16666666

#define SMPTE296M_720P50_HSYNC_PERIOD 26666
#define SMPTE296M_720P50_VSYNC_PERIOD 20000000

#define SMPTE296M_720P30_HSYNC_PERIOD 22500
#define SMPTE296M_720P30_VSYNC_PERIOD 33333333

#define SMPTE296M_720P25_HSYNC_PERIOD 53333
#define SMPTE296M_720P25_VSYNC_PERIOD 40000000

#define SMPTE296M_720P24_HSYNC_PERIOD 55555
#define SMPTE296M_720P24_VSYNC_PERIOD 41666666

/* SMPTE274M */
#define SMPTE274M_1080I60_HSYNC_PERIOD 14814
#define SMPTE274M_1080I60_VSYNC_PERIOD 16666666

#define SMPTE274M_1080I40_HSYNC_PERIOD 22222
#define SMPTE274M_1080I40_VSYNC_PERIOD 25000000

#define SMPTE274M_1080I30_HSYNC_PERIOD 29629
#define SMPTE274M_1080I30_VSYNC_PERIOD 33333333

#define SMPTE274M_1080I25_HSYNC_PERIOD 35555
#define SMPTE274M_1080I25_VSYNC_PERIOD 40000000

#define SMPTE274M_1080I24_HSYNC_PERIOD 37037
#define SMPTE274M_1080I24_VSYNC_PERIOD 41666666

/* genlock si5324 configurations */

/* SMPTE259M */
static const uint16_t si5324_genlock_smpte259m_pal_regs[][2] = {
    {   0, 0x14 },
    {   1, 0xe4 },
    {   2, 0x32 },
    {   3, 0x15 },
    {   4, 0x92 },
    {   5, 0xed },
    {   6, 0x2d },
    {   7, 0x2a },
    {   8, 0x00 },
    {   9, 0xc0 },
    {  10, 0x00 },
    {  11, 0x40 },
    {  19, 0x29 },
    {  20, 0x3e },
    {  21, 0xff },
    {  22, 0xdf },
    {  23, 0x1f },
    {  24, 0x3f },
    {  25, 0x40 },
    {  31, 0x00 },
    {  32, 0x00 },
    {  33, 0x05 },
    {  34, 0x00 },
    {  35, 0x00 },
    {  36, 0x05 },
    {  40, 0x01 },
    {  41, 0x4e },
    {  42, 0x1f },
    {  43, 0x00 },
    {  44, 0x00 },
    {  45, 0x00 },
    {  46, 0x00 },
    {  47, 0x00 },
    {  48, 0x00 },
    {  55, 0x00 },
    { 131, 0x1f },
    { 132, 0x02 },
    { 137, 0x01 },
    { 138, 0x0f },
    { 139, 0xff },
    { 142, 0x00 },
    { 143, 0x00 },
    { 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte259m_ntsc_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xE4 },
	{   2, 0x32 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xED },
	{   6, 0x2D },
	{   7, 0x2A },
	{   8, 0x00 },
	{   9, 0xC0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3E },
	{  21, 0xFF },
	{  22, 0xDF },
	{  23, 0x1F },
	{  24, 0x3F },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x60 },
	{  41, 0xBD },
	{  42, 0x69 },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1F },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0F },
	{ 139, 0xFF },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

/* SMPTE296M */

static const uint16_t si5324_genlock_smpte296m_720p60_regs[][2] = {
    {   0, 0x14 },
    {   1, 0xe4 },
    {   2, 0x52 },
    {   3, 0x15 },
    {   4, 0x92 },
    {   5, 0xed },
    {   6, 0x2d },
    {   7, 0x2a },
    {   8, 0x00 },
    {   9, 0xc0 },
    {  10, 0x00 },
    {  11, 0x40 },
    {  19, 0x29 },
    {  20, 0x3e },
    {  21, 0xff },
    {  22, 0xdf },
    {  23, 0x1f },
    {  24, 0x3f },
    {  25, 0x40 },
    {  31, 0x00 },
    {  32, 0x00 },
    {  33, 0x05 },
    {  34, 0x00 },
    {  35, 0x00 },
    {  36, 0x05 },
    {  40, 0x20 },
    {  41, 0x5c },
    {  42, 0xcf },
    {  43, 0x00 },
    {  44, 0x00 },
    {  45, 0x00 },
    {  46, 0x00 },
    {  47, 0x00 },
    {  48, 0x00 },
    {  55, 0x00 },
    { 131, 0x1f },
    { 132, 0x02 },
    { 137, 0x01 },
    { 138, 0x0f },
    { 139, 0xff },
    { 142, 0x00 },
    { 143, 0x00 },
    { 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte296m_720p50_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x52 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x20 },
	{  41, 0x6f },
	{  42, 0x5f },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte296m_720p30_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x42 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0xc0 },
	{  41, 0x5c },
	{  42, 0xcf },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte296m_720p25_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x42 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x01 },
	{  41, 0x16 },
	{  42, 0x6f },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte296m_720p24_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x42 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x01 },
	{  41, 0x22 },
	{  42, 0x09 },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

/* SMPTE274M */
static const uint16_t si5324_genlock_smpte274m_1080i60_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x62 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x20 },
	{  41, 0x3d },
	{  42, 0xdf },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte274m_1080i40_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x52 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x20 },
	{  41, 0x5c },
	{  42, 0xcf },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte274m_1080i30_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x52 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x20 },
	{  41, 0x7b },
	{  42, 0xbf },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte274m_1080i25_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xe4 },
	{   2, 0x42 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xed },
	{   6, 0x2d },
	{   7, 0x2a },
	{   8, 0x00 },
	{   9, 0xc0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3e },
	{  21, 0xff },
	{  22, 0xdf },
	{  23, 0x1f },
	{  24, 0x3f },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0x20 },
	{  41, 0x94 },
	{  42, 0x7f },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1f },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0f },
	{ 139, 0xff },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

static const uint16_t si5324_genlock_smpte274m_1080i24_regs[][2] = {
	{   0, 0x14 },
	{   1, 0xE4 },
	{   2, 0x42 },
	{   3, 0x15 },
	{   4, 0x92 },
	{   5, 0xED },
	{   6, 0x2D },
	{   7, 0x2A },
	{   8, 0x00 },
	{   9, 0xC0 },
	{  10, 0x00 },
	{  11, 0x40 },
	{  19, 0x29 },
	{  20, 0x3E },
	{  21, 0xFF },
	{  22, 0xDF },
	{  23, 0x1F },
	{  24, 0x3F },
	{  25, 0x40 },
	{  31, 0x00 },
	{  32, 0x00 },
	{  33, 0x05 },
	{  34, 0x00 },
	{  35, 0x00 },
	{  36, 0x05 },
	{  40, 0xC0 },
	{  41, 0x4D },
	{  42, 0x57 },
	{  43, 0x00 },
	{  44, 0x00 },
	{  45, 0x00 },
	{  46, 0x00 },
	{  47, 0x00 },
	{  48, 0x00 },
	{  55, 0x00 },
	{ 131, 0x1F },
	{ 132, 0x02 },
	{ 137, 0x01 },
	{ 138, 0x0F },
	{ 139, 0xFF },
	{ 142, 0x00 },
	{ 143, 0x00 },
	{ 136, 0x40 },
};

#endif /* GENLOCK_H */
